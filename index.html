
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Germany Travel Bucket List</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS for the Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

    <style>
        :root {
            --bg-color: #1a2233; /* Deep, rich blue */
            --bg-gradient: radial-gradient(circle at top center, #2c3e5e 0%, #1a2233 100%);
            --card-color: #f7f3e8; /* Soft off-white/cream */
            --card-hover: #ffffff;
            --accent-gold: #cfaa68; /* Elegant gold */
            --text-main: #2d3436;
            --text-sub: #636e72;
            --visited-bg: #dfe6e9;
            --visited-text: #b2bec3;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.15);
            --shadow-lg: 0 15px 30px rgba(0,0,0,0.25);
        }

        body {
            background: var(--bg-color);
            background: var(--bg-gradient);
            font-family: 'Inter', sans-serif;
            color: var(--text-main);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }

        .container {
            max-width: 1400px;
            width: 100%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Updated Floating Header */
        header {
            text-align: center;
            color: var(--card-color); /* Beige instead of white */
            margin-bottom: 40px;
            width: 95%;
            max-width: 800px; /* Keep it compact */
            position: sticky;
            top: 20px;
            z-index: 100;
            padding: 15px 30px;
            background: rgba(26, 34, 51, 0.9); /* Slightly more opaque for readability */
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 50px; /* Fully rounded pill shape */
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            margin: 0 0 12px 0;
            letter-spacing: 1px;
            color: var(--accent-gold);
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* --- Toggle Switch Styles --- */
        .switch-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
        }

        .switch-label {
            font-weight: 600;
            color: var(--card-color); /* Matches theme better */
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 1.5px;
            cursor: pointer;
            transition: color 0.3s;
            opacity: 0.8;
        }
        
        .switch-label:hover { opacity: 1; color: var(--accent-gold); }

        .switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 28px;
        }

        .switch input { opacity: 0; width: 0; height: 0; }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(247, 243, 232, 0.2);
            transition: .4s;
            border-radius: 34px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: var(--accent-gold);
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        input:checked + .slider { background-color: rgba(247, 243, 232, 0.3); }
        input:checked + .slider:before { transform: translateX(24px); background-color: var(--card-color); }

        /* --- Grid View Styles --- */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            width: 100%;
            padding-bottom: 40px;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background-color: var(--card-color);
            border-radius: 16px;
            text-decoration: none;
            aspect-ratio: 3/4;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px 15px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            box-shadow: var(--shadow-sm);
            position: relative;
            user-select: none;
            border: 1px solid rgba(0,0,0,0.03);
        }

        .card:hover {
            transform: translateY(-8px);
            background-color: var(--card-hover);
            box-shadow: var(--shadow-lg);
            z-index: 10;
        }

        /* Checkbox Styling */
        .checkbox-container {
            position: absolute;
            top: 12px;
            right: 12px;
            z-index: 5;
            width: 24px;
            height: 24px;
        }

        /* Custom Checkbox Appearance */
        .visit-checkbox {
            appearance: none;
            -webkit-appearance: none;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.05);
            border: 2px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
            display: grid;
            place-content: center;
        }

        .visit-checkbox::before {
            content: "✓";
            color: #fff;
            font-size: 14px;
            font-weight: bold;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.2s;
        }

        .visit-checkbox:hover { border-color: var(--accent-gold); }

        .visit-checkbox:checked {
            background-color: var(--accent-gold);
            border-color: var(--accent-gold);
        }
        
        .visit-checkbox:checked::before { opacity: 1; transform: scale(1); }

        /* Visited State */
        .card.visited {
            background-color: var(--visited-bg);
            box-shadow: none;
            opacity: 0.8;
            transform: scale(0.98);
        }
        
        .card.visited .place-name { color: var(--visited-text); text-decoration: line-through; }
        .card.visited .location-name { color: var(--visited-text); }
        .card.visited:hover { transform: scale(1); opacity: 1; }

        .place-name {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--text-main);
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .location-name {
            font-size: 0.7rem;
            font-weight: 500;
            text-transform: uppercase;
            color: var(--text-sub);
            letter-spacing: 0.5px;
        }

        /* --- Map View Styles --- */
        #map-view {
            display: none;
            height: 75vh;
            width: 100%;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 4px solid rgba(255,255,255,0.1);
        }

        /* Leaflet Customization */
        .leaflet-popup-content-wrapper {
            background-color: var(--card-color);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            font-family: 'Inter', sans-serif;
        }
        .leaflet-popup-tip { background-color: var(--card-color); }
        .popup-title { 
            font-family: 'Playfair Display', serif; 
            font-weight: 700; 
            font-size: 1.1rem; 
            display: block; 
            margin-bottom: 4px; 
            color: var(--text-main);
        }
        .popup-link { 
            display: inline-block; 
            background-color: var(--accent-gold); 
            color: #fff; 
            text-decoration: none; 
            padding: 8px 16px; 
            font-size: 0.75rem; 
            font-weight: 600;
            border-radius: 20px; 
            margin-top: 10px;
            transition: background 0.2s;
        }
        .popup-link:hover { background-color: #b38f50; }

        /* Custom Map Marker CSS */
        .custom-marker-pin {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-gold);
            border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }
        
        .custom-marker-pin.visited {
            background: #95a5a6;
            width: 12px;
            height: 12px;
            opacity: 0.7;
        }
        
        .custom-marker-pin:hover {
            transform: scale(1.3);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
            z-index: 1000;
        }

        @media (max-width: 600px) {
            .grid-container { grid-template-columns: repeat(2, 1fr); gap: 12px; }
            h1 { font-size: 1.5rem; }
            header { padding: 10px 20px; width: 90%; }
            .card { padding: 15px 10px; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Bucket List Deutschland</h1>
        
        <!-- Toggle Switch UI -->
        <div class="switch-container">
            <span class="switch-label" onclick="setMode('list')">List</span>
            <label class="switch">
                <input type="checkbox" id="viewToggle" onchange="toggleView()">
                <span class="slider"></span>
            </label>
            <span class="switch-label" onclick="setMode('map')">Map</span>
        </div>
    </header>

    <!-- LIST VIEW - Content Generated by JS -->
    <div id="listView" class="grid-container"></div>

    <!-- MAP VIEW CONTAINER -->
    <div id="map-view"></div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

<script>
    let mapInitialized = false;
    let map;
    let markers = []; // Store markers to update them later
    
    // Load visited state from localStorage
    let visitedPlaces = JSON.parse(localStorage.getItem('germany_bucket_list_visited')) || {};

    const places = [
        // --- Poster 1 (1-30) ---
        { name: "Vitra Design Museum", location: "Weil am Rhein", lat: 47.6015, lng: 7.6189 },
        { name: "Insel Mainau", location: "Bodensee", lat: 47.7056, lng: 9.1953 },
        { name: "Berchtesgaden", location: "Oberbayern", lat: 47.6306, lng: 13.0016 },
        { name: "Neuer Leuchtturm", location: "Lindau", lat: 47.5446, lng: 9.6833 },
        { name: "Basteibrücke", location: "Sächsische Schweiz", lat: 50.9619, lng: 14.0727 },
        { name: "Schloss Nymphenburg", location: "München", lat: 48.1582, lng: 11.5036 },
        { name: "Bamberg", location: "Bayern", lat: 49.8988, lng: 10.9028 },
        { name: "Schloss Drachenburg", location: "Königswinter", lat: 50.6669, lng: 7.2066 },
        { name: "Alte Brücke", location: "Heidelberg", lat: 49.4137, lng: 8.7095 },
        { name: "NP Bayerischer Wald", location: "Landkreis Regen", lat: 48.9667, lng: 13.4167 },
        { name: "Schachen", location: "Bayern", lat: 47.4186, lng: 11.1114 },
        { name: "Hintersee", location: "Ramsau bei Berchtesgaden", lat: 47.6069, lng: 12.8550 },
        { name: "Kölner Dom", location: "Köln", lat: 50.9413, lng: 6.9583 },
        { name: "Kirschblütenstraße", location: "Bonn", lat: 50.7383, lng: 7.0944 },
        { name: "Reichstag", location: "Berlin", lat: 52.5186, lng: 13.3762 },
        { name: "Garmisch-Partenkirchen", location: "Oberbayern", lat: 47.4917, lng: 11.0955 },
        { name: "Schwarzwald", location: "Baden-Württemberg", lat: 48.1303, lng: 8.2323 },
        { name: "Alatsee", location: "Ostallgäu", lat: 47.5622, lng: 10.6094 },
        { name: "Baden-Baden", location: "Baden-Württemberg", lat: 48.7617, lng: 8.2413 },
        { name: "Zeche Zollern", location: "Dortmund", lat: 51.5178, lng: 7.3333 },
        { name: "Meißen", location: "Sachsen", lat: 51.1636, lng: 13.4774 },
        { name: "Museum Ludwig", location: "Köln", lat: 50.9405, lng: 6.9606 },
        { name: "Bernkastel-Kues", location: "Rheinland-Pfalz", lat: 49.9167, lng: 7.0667 },
        { name: "Naturpark Barnim", location: "Brandenburg", lat: 52.7500, lng: 13.5000 },
        { name: "Erfurt", location: "Thüringen", lat: 50.9848, lng: 11.0299 },
        { name: "Ammergauer Alpen", location: "Nördlichen Kalkalpen", lat: 47.5667, lng: 10.9500 },
        { name: "NP Jasmund", location: "Rügen", lat: 54.5500, lng: 13.6333 },
        { name: "Böttcherstraße", location: "Bremen", lat: 53.0754, lng: 8.8058 },
        { name: "Rakotzbrücke", location: "Gablenz", lat: 51.5363, lng: 14.6406 },
        { name: "Ramsau bei Berchtesgaden", location: "Bayern", lat: 47.6067, lng: 12.8950 },

        // --- Poster 2 (31-60) ---
        { name: "Mainzer Dom", location: "Mainz", lat: 49.9989, lng: 8.2739 },
        { name: "Schrecksee", location: "Allgäuer Alpen", lat: 47.4725, lng: 10.4686 },
        { name: "Rothenburg ob der Tauber", location: "Bayern", lat: 49.3767, lng: 10.1772 },
        { name: "Die Barbarine", location: "Sächsische Schweiz", lat: 50.9272, lng: 14.0578 },
        { name: "Städel Museum", location: "Frankfurt", lat: 50.1064, lng: 8.6739 },
        { name: "Lilienstein", location: "Sächsische Schweiz", lat: 50.9317, lng: 14.0847 },
        { name: "Tübingen", location: "Baden-Württemberg", lat: 48.5216, lng: 9.0576 },
        { name: "Schloss Heidelberg", location: "Heidelberg", lat: 49.4106, lng: 8.7153 },
        { name: "Ostseebad Sellin", location: "Insel Rügen", lat: 54.3808, lng: 13.6933 },
        { name: "Festung Königstein", location: "Königstein", lat: 50.9195, lng: 14.0567 },
        { name: "Kunstkraftwerk", location: "Leipzig", lat: 51.3327, lng: 12.3242 },
        { name: "Freudenberg", location: "Nordrhein-Westfalen", lat: 50.8972, lng: 7.8736 },
        { name: "Berliner Mauer", location: "Berlin", lat: 52.5050, lng: 13.4397 },
        { name: "Oberammergau", location: "Bayern", lat: 47.5956, lng: 11.0628 },
        { name: "Eisenach", location: "Wartburg", lat: 50.9663, lng: 10.3064 },
        { name: "Naturpark Arnsberger Wald", location: "Arnsberg", lat: 51.4500, lng: 8.2500 },
        { name: "Helgoland", location: "Schleswig-Holstein", lat: 54.1803, lng: 7.8925 },
        { name: "Brodtener Steilküste", location: "Lübeck", lat: 53.9833, lng: 10.8833 },
        { name: "Eibsee", location: "Berchtesgadener Alpen", lat: 47.4569, lng: 10.9922 },
        { name: "Miniatur Wunderland", location: "Hamburg", lat: 53.5439, lng: 9.9886 },
        { name: "Partnachklamm", location: "Garmisch-Partenkirchen", lat: 47.4686, lng: 11.1194 },
        { name: "Alexanderplatz", location: "Berlin", lat: 52.5219, lng: 13.4132 },
        { name: "Wismar", location: "Mecklenburg-Vorpommern", lat: 53.8910, lng: 11.4594 },
        { name: "Sanssouci", location: "Potsdam", lat: 52.4042, lng: 13.0385 },
        { name: "Schloss Linderhof", location: "Ettal", lat: 47.5700, lng: 10.9608 },
        { name: "Schloss Marienburg", location: "Pattensen", lat: 52.1728, lng: 9.7661 },
        { name: "Mercedes-Benz Welt", location: "Stuttgart", lat: 48.7900, lng: 9.2300 },
        { name: "Prinzipalmarkt", location: "Münster", lat: 51.9625, lng: 7.6256 },
        { name: "Röthbachfall", location: "Berchtesgadener Alpen", lat: 47.5050, lng: 13.0133 },
        { name: "Deutsches Eck", location: "Koblenz", lat: 50.3644, lng: 7.6059 },

        // --- Poster 3 (61-100) ---
        { name: "Porta Nigra", location: "Trier", lat: 49.7597, lng: 6.6440 },
        { name: "Pirna", location: "Sachsen", lat: 50.9625, lng: 13.9419 },
        { name: "Schloss Moritzburg", location: "Moritzburg", lat: 51.1836, lng: 13.6797 },
        { name: "Schloss Neuschwanstein", location: "Schwangau", lat: 47.5576, lng: 10.7498 },
        { name: "Insel Sylt", location: "Schleswig-Holstein", lat: 54.9133, lng: 8.3333 },
        { name: "BMW Welt", location: "München", lat: 48.1768, lng: 11.5562 },
        { name: "Schloss Schwerin", location: "Schwerin", lat: 53.6225, lng: 11.4189 },
        { name: "Struffeltroute", location: "Roetgen", lat: 50.6483, lng: 6.2239 },
        { name: "Freiburg im Breisgau", location: "Baden-Württemberg", lat: 47.9990, lng: 7.8421 },
        { name: "Porsche-Museum", location: "Stuttgart", lat: 48.8353, lng: 9.1524 },
        { name: "Insel Hiddensee", location: "West-Rügen", lat: 54.5369, lng: 13.1114 },
        { name: "Blautopf", location: "Blaubeuren", lat: 48.4161, lng: 9.7844 },
        { name: "Triberger Wasserfälle", location: "Mittlerer Schwarzwald", lat: 48.1286, lng: 8.2289 },
        { name: "Dinkelsbühl", location: "Bayern", lat: 49.0692, lng: 10.3217 },
        { name: "Insel Fehmarn", location: "Schleswig-Holstein", lat: 54.4361, lng: 11.1956 },
        { name: "Loreley", location: "Bornich", lat: 50.1389, lng: 7.7286 },
        { name: "Tangermünde", location: "Sachsen-Anhalt", lat: 52.5408, lng: 11.9703 },
        { name: "Ladenburg", location: "Baden-Württemberg", lat: 49.4719, lng: 8.6097 },
        { name: "Burg Eltz", location: "Wierschem", lat: 50.2053, lng: 7.3367 },
        { name: "Markgräfliches Opernhaus", location: "Bayreuth", lat: 49.9444, lng: 11.5786 },
        { name: "Forggensee", location: "Füssen", lat: 47.6075, lng: 10.7417 },
        { name: "Externsteine", location: "Teutoburger Wald", lat: 51.8689, lng: 8.9175 },
        { name: "Insel Juist", location: "Niedersachsen", lat: 53.6833, lng: 7.0000 },
        { name: "Zentralgebäude", location: "Lüneburg", lat: 53.2464, lng: 10.4117 },
        { name: "Quedlinburg", location: "Sachsen-Anhalt", lat: 51.7895, lng: 11.1492 },
        { name: "Bauhaus Dessau", location: "Dessau-Rosslau", lat: 51.8386, lng: 12.2275 },
        { name: "Zugspitze", location: "Bayerische Alpen", lat: 47.4210, lng: 10.9853 },
        { name: "Insel Amrum", location: "Schleswig-Holstein", lat: 54.6500, lng: 8.3500 },
        { name: "Mühlenmuseum", location: "Gifhorn", lat: 52.4894, lng: 10.5500 },
        { name: "KZ Dachau", location: "Dachau", lat: 48.2703, lng: 11.4683 },
        { name: "Botanischer Garten", location: "München", lat: 48.1633, lng: 11.5017 },
        { name: "Naturpark Müritz", location: "Müritz", lat: 53.4000, lng: 12.8333 },
        { name: "Kaiser Wilhelm Gedächtniskirche", location: "Berlin", lat: 52.5047, lng: 13.3350 },
        { name: "Luisenpark", location: "Mannheim", lat: 49.4864, lng: 8.4947 },
        { name: "Museum Vogtsbauernhof", location: "Gutach", lat: 48.2717, lng: 8.2000 },
        { name: "Westmole", location: "Warnemünde", lat: 54.1833, lng: 12.0833 },
        { name: "Wünsdorf", location: "Zossen", lat: 52.1706, lng: 13.4681 },
        { name: "Fürstengarten Marienberg", location: "Würzburg", lat: 49.7917, lng: 9.9222 },
        { name: "Zauberwald", location: "Hintersee", lat: 47.6083, lng: 12.8583 },
        { name: "Wuppertal Schwebebahn", location: "Wuppertal", lat: 51.2561, lng: 7.1508 }
    ];
    
    // Function to render the list dynamically
    function renderList() {
        const listContainer = document.getElementById('listView');
        listContainer.innerHTML = ''; // Clear existing content
        
        places.forEach((place, index) => {
            const isVisited = visitedPlaces[place.name];
            
            const card = document.createElement('div');
            card.className = 'card ' + (isVisited ? 'visited' : '');
            // We use onclick here to navigate only if checkbox wasn't clicked
            card.onclick = (e) => openPlaceLink(e, place);
            
            const checkboxContainer = document.createElement('div');
            checkboxContainer.className = 'checkbox-container';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'visit-checkbox';
            checkbox.checked = !!isVisited;
            checkbox.onclick = (e) => toggleVisited(e, place.name, index);
            
            checkboxContainer.appendChild(checkbox);
            
            const nameDiv = document.createElement('div');
            nameDiv.className = 'place-name';
            nameDiv.innerText = place.name;
            
            const locDiv = document.createElement('div');
            locDiv.className = 'location-name';
            locDiv.innerText = place.location;
            
            card.appendChild(checkboxContainer);
            card.appendChild(nameDiv);
            card.appendChild(locDiv);
            
            listContainer.appendChild(card);
        });
    }
    
    function openPlaceLink(e, place) {
        // Only open link if we didn't click the checkbox
        if (!e.target.classList.contains('visit-checkbox')) {
             const url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(place.name + " " + place.location)}`;
             window.open(url, '_blank');
        }
    }
    
    function toggleVisited(e, placeName, index) {
        e.stopPropagation(); // Stop the card click event
        
        // Toggle state
        if (visitedPlaces[placeName]) {
            delete visitedPlaces[placeName];
        } else {
            visitedPlaces[placeName] = true;
        }
        
        // Save to localStorage
        localStorage.setItem('germany_bucket_list_visited', JSON.stringify(visitedPlaces));
        
        // Re-render list to show changes (or simple class toggle for performance)
        renderList();
        
        // If map is initialized, update marker styles
        if (mapInitialized && markers[index]) {
             updateMarkerStyle(markers[index], !!visitedPlaces[placeName]);
        }
    }
    
    function updateMarkerStyle(marker, isVisited) {
        const el = marker.getElement();
        if (el) {
            el.innerHTML = `<div class="custom-marker-pin ${isVisited ? 'visited' : ''}"></div>`;
        }
    }

    function setMode(mode) {
        const checkbox = document.getElementById('viewToggle');
        if (mode === 'map' && !checkbox.checked) {
            checkbox.checked = true;
            toggleView();
        } else if (mode === 'list' && checkbox.checked) {
            checkbox.checked = false;
            toggleView();
        }
    }

    function toggleView() {
        const listView = document.getElementById('listView');
        const mapView = document.getElementById('map-view');
        const checkbox = document.getElementById('viewToggle');

        if (checkbox.checked) {
            // Switch to MAP
            listView.style.display = 'none';
            mapView.style.display = 'block';
            
            // Initialize map if first time
            if (!mapInitialized) {
                initMap();
                mapInitialized = true;
            } else {
                map.invalidateSize(); 
                refreshMapMarkers();
            }
        } else {
            // Switch to LIST
            listView.style.display = 'grid';
            mapView.style.display = 'none';
        }
    }

    function initMap() {
        map = L.map('map-view').setView([51.1657, 10.4515], 6);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
        }).addTo(map);

        createMarkers();
    }
    
    function createMarkers() {
        places.forEach(function(place, index) {
            var googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(place.name + " " + place.location)}`;

            var popupContent = `
                <span class="popup-title">${place.name}</span>
                <span class="popup-location">${place.location}</span>
                <a href="${googleMapsUrl}" target="_blank" class="popup-link">Open in Google Maps</a>
            `;
            
            // Use divIcon for custom markers styling
            const isVisited = visitedPlaces[place.name];
            const myIcon = L.divIcon({
                className: 'custom-marker',
                html: `<div class="custom-marker-pin ${isVisited ? 'visited' : ''}"></div>`,
                iconSize: [20, 20],
                iconAnchor: [10, 10],
                popupAnchor: [0, -10]
            });

            var marker = L.marker([place.lat, place.lng], { icon: myIcon })
                .addTo(map)
                .bindPopup(popupContent);
                
            markers[index] = marker; // Store reference
        });
    }
    
    function refreshMapMarkers() {
         places.forEach((place, index) => {
             if (markers[index]) {
                 updateMarkerStyle(markers[index], !!visitedPlaces[place.name]);
             }
         });
    }

    // Initialize list on load
    renderList();
</script>

</body>
</html>
