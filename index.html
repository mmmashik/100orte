<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Germany Travel Bucket List</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS for the Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

    <style>
        :root {
            --bg-color: #1a2233;
            --bg-gradient: radial-gradient(circle at top center, #2c3e5e 0%, #1a2233 100%);
            --card-color: #f7f3e8;
            --accent-gold: #cfaa68;
            --text-main: #2d3436;
            --text-sub: #636e72;
            --visited-bg: #95a5a6;
            --shadow-lg: 0 8px 20px rgba(0,0,0,0.25);
        }

        body {
            background: var(--bg-color);
            background: var(--bg-gradient);
            font-family: 'Inter', sans-serif;
            color: var(--text-main);
            margin: 0;
            padding: 0;
            height: 100vh; /* Full viewport height */
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Prevent scrolling on body */
        }

        /* Compact Header for Map View */
        header {
            text-align: center;
            color: var(--card-color);
            padding: 15px 20px;
            background: rgba(26, 34, 51, 0.95);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            flex-shrink: 0; /* Prevent header from shrinking */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 12px;
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            margin: 0;
            letter-spacing: 1px;
            color: var(--accent-gold);
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* --- Search Bar Styles --- */
        .search-container {
            position: relative;
            width: 100%;
            max-width: 300px;
        }

        #search-input {
            width: 100%;
            padding: 10px 15px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1);
            color: var(--card-color);
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            outline: none;
            transition: all 0.3s;
            box-sizing: border-box; /* Ensures padding doesn't affect width */
        }

        #search-input::placeholder {
            color: rgba(247, 243, 232, 0.5);
        }

        #search-input:focus {
            background: rgba(26, 34, 51, 1);
            border-color: var(--accent-gold);
            box-shadow: 0 0 10px rgba(207, 170, 104, 0.3);
        }

        #search-results {
            position: absolute;
            top: 110%;
            left: 0;
            right: 0;
            background: var(--card-color);
            border-radius: 10px;
            max-height: 250px;
            overflow-y: auto;
            display: none;
            z-index: 2000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        .search-result-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item:hover {
            background: #e8e4d9;
        }

        .search-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .search-loc {
            font-size: 0.75rem;
            color: var(--text-sub);
            text-transform: uppercase;
        }

        /* Full Screen Map Container */
        #map-container {
            flex-grow: 1; /* Fills remaining height */
            position: relative;
            width: 100%;
            z-index: 1;
        }

        #map-view {
            height: 100%;
            width: 100%;
            background-color: #aad3df;
        }

        /* Leaflet Customization */
        .leaflet-popup-content-wrapper {
            background-color: var(--card-color);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            font-family: 'Inter', sans-serif;
            padding: 0;
            overflow: hidden;
        }
        .leaflet-popup-content {
            margin: 15px 20px;
            text-align: center;
            min-width: 200px;
        }
        .leaflet-popup-tip { background-color: var(--card-color); }
        
        .popup-title { 
            font-family: 'Playfair Display', serif; 
            font-weight: 700; 
            font-size: 1.1rem; 
            display: block; 
            margin-bottom: 4px; 
            color: var(--text-main);
        }
        
        .popup-location {
            display: block;
            font-size: 0.75rem;
            color: var(--text-sub);
            text-transform: uppercase;
            margin-bottom: 12px;
            letter-spacing: 0.5px;
        }

        .popup-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .popup-btn { 
            display: block;
            text-decoration: none; 
            padding: 10px 0; 
            font-size: 0.8rem; 
            font-weight: 600;
            border-radius: 8px; 
            text-align: center;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            width: 100%;
        }

        .btn-maps {
            background-color: var(--accent-gold); 
            color: #fff; 
        }
        .btn-maps:hover { background-color: #b38f50; }

        .btn-toggle-visit {
            background-color: rgba(0,0,0,0.05);
            color: var(--text-sub);
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        .btn-toggle-visit.is-visited {
            background-color: var(--text-main);
            color: #fff;
        }

        /* Custom Map Marker CSS */
        .custom-marker-pin {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--accent-gold);
            border: 3px solid #fff;
            box-shadow: 0 3px 8px rgba(0,0,0,0.4);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .custom-marker-pin.visited {
            background: var(--visited-bg);
            border-color: #ecf0f1;
            transform: scale(0.8);
            opacity: 0.8;
        }
        
        .leaflet-marker-icon:hover .custom-marker-pin {
            transform: scale(1.3);
            z-index: 1000;
        }

        @media (max-width: 600px) {
            h1 { font-size: 1rem; }
            header { padding: 12px; }
            .leaflet-popup-content { min-width: 180px; margin: 12px 15px; }
        }
    </style>
</head>
<body>

<header>
    <h1>Bucket List Deutschland</h1>
    <div class="search-container">
        <input type="text" id="search-input" placeholder="Search for a place..." oninput="performSearch(this.value)">
        <div id="search-results"></div>
    </div>
</header>

<!-- MAP VIEW CONTAINER -->
<div id="map-container">
    <div id="map-view"></div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

<script>
    let map;
    let markers = []; 
    
    // Load visited state from localStorage
    let visitedPlaces = JSON.parse(localStorage.getItem('germany_bucket_list_visited')) || {};

    const places = [
        // --- Poster 1 (1-30) ---
        { name: "Vitra Design Museum", location: "Weil am Rhein", lat: 47.6015, lng: 7.6189 },
        { name: "Insel Mainau", location: "Bodensee", lat: 47.7056, lng: 9.1953 },
        { name: "Berchtesgaden", location: "Oberbayern", lat: 47.6306, lng: 13.0016 },
        { name: "Neuer Leuchtturm", location: "Lindau", lat: 47.5446, lng: 9.6833 },
        { name: "Basteibrücke", location: "Sächsische Schweiz", lat: 50.9619, lng: 14.0727 },
        { name: "Schloss Nymphenburg", location: "München", lat: 48.1582, lng: 11.5036 },
        { name: "Bamberg", location: "Bayern", lat: 49.8988, lng: 10.9028 },
        { name: "Schloss Drachenburg", location: "Königswinter", lat: 50.6669, lng: 7.2066 },
        { name: "Alte Brücke", location: "Heidelberg", lat: 49.4137, lng: 8.7095 },
        { name: "NP Bayerischer Wald", location: "Landkreis Regen", lat: 48.9667, lng: 13.4167 },
        { name: "Schachen", location: "Bayern", lat: 47.4186, lng: 11.1114 },
        { name: "Hintersee", location: "Ramsau bei Berchtesgaden", lat: 47.6069, lng: 12.8550 },
        { name: "Kölner Dom", location: "Köln", lat: 50.9413, lng: 6.9583 },
        { name: "Kirschblütenstraße", location: "Bonn", lat: 50.7383, lng: 7.0944 },
        { name: "Reichstag", location: "Berlin", lat: 52.5186, lng: 13.3762 },
        { name: "Garmisch-Partenkirchen", location: "Oberbayern", lat: 47.4917, lng: 11.0955 },
        { name: "Schwarzwald", location: "Baden-Württemberg", lat: 48.1303, lng: 8.2323 },
        { name: "Alatsee", location: "Ostallgäu", lat: 47.5622, lng: 10.6094 },
        { name: "Baden-Baden", location: "Baden-Württemberg", lat: 48.7617, lng: 8.2413 },
        { name: "Zeche Zollern", location: "Dortmund", lat: 51.5178, lng: 7.3333 },
        { name: "Meißen", location: "Sachsen", lat: 51.1636, lng: 13.4774 },
        { name: "Museum Ludwig", location: "Köln", lat: 50.9405, lng: 6.9606 },
        { name: "Bernkastel-Kues", location: "Rheinland-Pfalz", lat: 49.9167, lng: 7.0667 },
        { name: "Naturpark Barnim", location: "Brandenburg", lat: 52.7500, lng: 13.5000 },
        { name: "Erfurt", location: "Thüringen", lat: 50.9848, lng: 11.0299 },
        { name: "Ammergauer Alpen", location: "Nördlichen Kalkalpen", lat: 47.5667, lng: 10.9500 },
        { name: "NP Jasmund", location: "Rügen", lat: 54.5500, lng: 13.6333 },
        { name: "Böttcherstraße", location: "Bremen", lat: 53.0754, lng: 8.8058 },
        { name: "Rakotzbrücke", location: "Gablenz", lat: 51.5363, lng: 14.6406 },
        { name: "Ramsau bei Berchtesgaden", location: "Bayern", lat: 47.6067, lng: 12.8950 },

        // --- Poster 2 (31-60) ---
        { name: "Mainzer Dom", location: "Mainz", lat: 49.9989, lng: 8.2739 },
        { name: "Schrecksee", location: "Allgäuer Alpen", lat: 47.4725, lng: 10.4686 },
        { name: "Rothenburg ob der Tauber", location: "Bayern", lat: 49.3767, lng: 10.1772 },
        { name: "Die Barbarine", location: "Sächsische Schweiz", lat: 50.9272, lng: 14.0578 },
        { name: "Städel Museum", location: "Frankfurt", lat: 50.1064, lng: 8.6739 },
        { name: "Lilienstein", location: "Sächsische Schweiz", lat: 50.9317, lng: 14.0847 },
        { name: "Tübingen", location: "Baden-Württemberg", lat: 48.5216, lng: 9.0576 },
        { name: "Schloss Heidelberg", location: "Heidelberg", lat: 49.4106, lng: 8.7153 },
        { name: "Ostseebad Sellin", location: "Insel Rügen", lat: 54.3808, lng: 13.6933 },
        { name: "Festung Königstein", location: "Königstein", lat: 50.9195, lng: 14.0567 },
        { name: "Kunstkraftwerk", location: "Leipzig", lat: 51.3327, lng: 12.3242 },
        { name: "Freudenberg", location: "Nordrhein-Westfalen", lat: 50.8972, lng: 7.8736 },
        { name: "Berliner Mauer", location: "Berlin", lat: 52.5050, lng: 13.4397 },
        { name: "Oberammergau", location: "Bayern", lat: 47.5956, lng: 11.0628 },
        { name: "Eisenach", location: "Wartburg", lat: 50.9663, lng: 10.3064 },
        { name: "Naturpark Arnsberger Wald", location: "Arnsberg", lat: 51.4500, lng: 8.2500 },
        { name: "Helgoland", location: "Schleswig-Holstein", lat: 54.1803, lng: 7.8925 },
        { name: "Brodtener Steilküste", location: "Lübeck", lat: 53.9833, lng: 10.8833 },
        { name: "Eibsee", location: "Oberbayern", lat: 47.4569, lng: 10.9922 }, // UPDATED LOCATION
        { name: "Miniatur Wunderland", location: "Hamburg", lat: 53.5439, lng: 9.9886 },
        { name: "Partnachklamm", location: "Garmisch-Partenkirchen", lat: 47.4686, lng: 11.1194 },
        { name: "Alexanderplatz", location: "Berlin", lat: 52.5219, lng: 13.4132 },
        { name: "Wismar", location: "Mecklenburg-Vorpommern", lat: 53.8910, lng: 11.4594 },
        { name: "Sanssouci", location: "Potsdam", lat: 52.4042, lng: 13.0385 },
        { name: "Schloss Linderhof", location: "Ettal", lat: 47.5700, lng: 10.9608 },
        { name: "Schloss Marienburg", location: "Pattensen", lat: 52.1728, lng: 9.7661 },
        { name: "Mercedes-Benz Welt", location: "Stuttgart", lat: 48.7900, lng: 9.2300 },
        { name: "Prinzipalmarkt", location: "Münster", lat: 51.9625, lng: 7.6256 },
        { name: "Röthbachfall", location: "Berchtesgadener Alpen", lat: 47.5050, lng: 13.0133 },
        { name: "Deutsches Eck", location: "Koblenz", lat: 50.3644, lng: 7.6059 },

        // --- Poster 3 (61-100) ---
        { name: "Porta Nigra", location: "Trier", lat: 49.7597, lng: 6.6440 },
        { name: "Pirna", location: "Sachsen", lat: 50.9625, lng: 13.9419 },
        { name: "Schloss Moritzburg", location: "Moritzburg", lat: 51.1836, lng: 13.6797 },
        { name: "Schloss Neuschwanstein", location: "Schwangau", lat: 47.5576, lng: 10.7498 },
        { name: "Insel Sylt", location: "Schleswig-Holstein", lat: 54.9133, lng: 8.3333 },
        { name: "Titan RT Hängebrücke", location: "Harz", lat: 51.7416, lng: 10.8925 }, // REPLACED BMW WELT
        { name: "Schloss Schwerin", location: "Schwerin", lat: 53.6225, lng: 11.4189 },
        { name: "Struffeltroute", location: "Roetgen", lat: 50.6483, lng: 6.2239 },
        { name: "Freiburg im Breisgau", location: "Baden-Württemberg", lat: 47.9990, lng: 7.8421 },
        { name: "Reichsburg Cochem", location: "Cochem", lat: 50.1416, lng: 7.1661 }, // REPLACED PORSCHE-MUSEUM
        { name: "Insel Hiddensee", location: "West-Rügen", lat: 54.5369, lng: 13.1114 },
        { name: "Blautopf", location: "Blaubeuren", lat: 48.4161, lng: 9.7844 },
        { name: "Traumschleife Baybachklamm", location: "Rheinland-Pfalz", lat: 50.1167, lng: 7.3500 }, // REPLACED TRIBERGER WASSERFÄLLE
        { name: "Dinkelsbühl", location: "Bayern", lat: 49.0692, lng: 10.3217 },
        { name: "Insel Fehmarn", location: "Schleswig-Holstein", lat: 54.4361, lng: 11.1956 },
        { name: "Loreley", location: "Bornich", lat: 50.1389, lng: 7.7286 },
        { name: "Tangermünde", location: "Sachsen-Anhalt", lat: 52.5408, lng: 11.9703 },
        { name: "Ladenburg", location: "Baden-Württemberg", lat: 49.4719, lng: 8.6097 },
        { name: "Burg Eltz", location: "Wierschem", lat: 50.2053, lng: 7.3367 },
        { name: "Markgräfliches Opernhaus", location: "Bayreuth", lat: 49.9444, lng: 11.5786 },
        { name: "Forggensee", location: "Füssen", lat: 47.6075, lng: 10.7417 }, // REVERTED TO FORGGENSEE
        { name: "Externsteine", location: "Teutoburger Wald", lat: 51.8689, lng: 8.9175 },
        { name: "Ulmer Münster", location: "Ulm", lat: 48.3986, lng: 9.9915 }, // REPLACED INSEL JUIST
        { name: "Zentralgebäude", location: "Lüneburg", lat: 53.2464, lng: 10.4117 },
        { name: "Quedlinburg", location: "Sachsen-Anhalt", lat: 51.7895, lng: 11.1492 },
        { name: "Bauhaus Dessau", location: "Dessau-Rosslau", lat: 51.8386, lng: 12.2275 },
        { name: "Zugspitze", location: "Bayerische Alpen", lat: 47.4210, lng: 10.9853 },
        { name: "Insel Amrum", location: "Schleswig-Holstein", lat: 54.6500, lng: 8.3500 },
        { name: "Mühlenmuseum", location: "Gifhorn", lat: 52.4894, lng: 10.5500 },
        { name: "KZ Dachau", location: "Dachau", lat: 48.2703, lng: 11.4683 },
        { name: "Botanischer Garten", location: "München", lat: 48.1633, lng: 11.5017 },
        { name: "Naturpark Müritz", location: "Müritz", lat: 53.4000, lng: 12.8333 },
        { name: "Nerobergbahn", location: "Wiesbaden", lat: 50.0984, lng: 8.2319 }, // REPLACED KAISER WILHELM
        { name: "Luisenpark", location: "Mannheim", lat: 49.4864, lng: 8.4947 },
        { name: "Museum Vogtsbauernhof", location: "Gutach", lat: 48.2717, lng: 8.2000 },
        { name: "Westmole", location: "Warnemünde", lat: 54.1833, lng: 12.0833 },
        { name: "Wünsdorf", location: "Zossen", lat: 52.1706, lng: 13.4681 },
        { name: "Fürstengarten Marienberg", location: "Würzburg", lat: 49.7917, lng: 9.9222 },
        { name: "Zauberwald", location: "Hintersee", lat: 47.6083, lng: 12.8583 },
        { name: "Wuppertal Schwebebahn", location: "Wuppertal", lat: 51.2561, lng: 7.1508 }
    ];

    function initMap() {
        // Center of Germany
        map = L.map('map-view').setView([51.1657, 10.4515], 6);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
        }).addTo(map);

        createMarkers();
        
        // Handle window resize to invalidate map size
        window.addEventListener('resize', () => {
             map.invalidateSize();
        });
    }
    
    function createMarkers() {
        places.forEach(function(place, index) {
            
            // Create a closure-safe toggle function string or handle via event delegation
            // Easier: bindPopup accepts HTML string or DOM element. We use DOM element for listeners.
            const container = document.createElement('div');
            
            const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(place.name + " " + place.location)}`;
            const isVisited = visitedPlaces[place.name];
            
            container.innerHTML = `
                <span class="popup-title">${place.name}</span>
                <span class="popup-location">${place.location}</span>
                <div class="popup-actions">
                    <button class="popup-btn btn-toggle-visit ${isVisited ? 'is-visited' : ''}" id="btn-visit-${index}">
                        ${isVisited ? 'Visited ✓' : 'Mark as Visited'}
                    </button>
                    <a href="${googleMapsUrl}" target="_blank" class="popup-btn btn-maps">
                        Open in Google Maps
                    </a>
                </div>
            `;
            
            // Add event listener to the button *after* it's added to DOM? 
            // Leaflet popups are tricky with event listeners if string is passed.
            // Using DOM node for content:
            
            const btnVisit = container.querySelector(`#btn-visit-${index}`);
            btnVisit.onclick = (e) => {
                toggleVisited(place.name, index, btnVisit);
            };

            const myIcon = L.divIcon({
                className: 'custom-marker',
                html: `<div class="custom-marker-pin ${isVisited ? 'visited' : ''}" id="pin-${index}"></div>`,
                iconSize: [20, 20],
                iconAnchor: [10, 10],
                popupAnchor: [0, -10]
            });

            var marker = L.marker([place.lat, place.lng], { icon: myIcon })
                .addTo(map)
                .bindPopup(container);
                
            markers[index] = marker; 
        });
    }
    
    function toggleVisited(placeName, index, btnElement) {
        if (visitedPlaces[placeName]) {
            delete visitedPlaces[placeName];
            btnElement.textContent = "Mark as Visited";
            btnElement.classList.remove('is-visited');
            updateMarkerVisual(index, false);
        } else {
            visitedPlaces[placeName] = true;
            btnElement.textContent = "Visited ✓";
            btnElement.classList.add('is-visited');
            updateMarkerVisual(index, true);
        }
        localStorage.setItem('germany_bucket_list_visited', JSON.stringify(visitedPlaces));
    }
    
    function updateMarkerVisual(index, isVisited) {
        const pin = document.getElementById(`pin-${index}`);
        if (pin) {
            if (isVisited) {
                pin.classList.add('visited');
            } else {
                pin.classList.remove('visited');
            }
        }
    }

    // --- Search Logic ---
    function performSearch(query) {
        const resultsContainer = document.getElementById('search-results');
        
        if (!query || query.length < 2) {
            resultsContainer.style.display = 'none';
            return;
        }
        
        const lowerQuery = query.toLowerCase();
        // Keep track of original index to know which marker to open
        const filteredPlaces = places.map((place, index) => ({...place, originalIndex: index}))
                                     .filter(place => 
                                        place.name.toLowerCase().includes(lowerQuery) || 
                                        place.location.toLowerCase().includes(lowerQuery)
                                     );
        
        resultsContainer.innerHTML = '';
        
        if (filteredPlaces.length > 0) {
            resultsContainer.style.display = 'block';
            filteredPlaces.forEach(place => {
                const item = document.createElement('div');
                item.className = 'search-result-item';
                item.innerHTML = `
                    <span class="search-name">${place.name}</span>
                    <span class="search-loc">${place.location}</span>
                `;
                item.onclick = () => selectPlace(place.originalIndex);
                resultsContainer.appendChild(item);
            });
        } else {
            resultsContainer.style.display = 'none';
        }
    }

    function selectPlace(index) {
        const place = places[index];
        const marker = markers[index];
        
        // Zoom and pan
        map.flyTo([place.lat, place.lng], 10, {
            duration: 1.5
        });
        
        // Open popup after animation (approx) or immediately
        // Leaflet flyTo is async, but openPopup works fine usually immediately or we can set timeout
        setTimeout(() => {
            marker.openPopup();
        }, 500);
        
        // Clear search
        document.getElementById('search-input').value = '';
        document.getElementById('search-results').style.display = 'none';
    }

    // Close search on click outside
    document.addEventListener('click', function(event) {
        const container = document.querySelector('.search-container');
        if (container && !container.contains(event.target)) {
            const results = document.getElementById('search-results');
            if(results) results.style.display = 'none';
        }
    });

    // Start map
    initMap();
</script>

</body>
</html>
